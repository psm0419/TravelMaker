<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="festival_mapper">
	
	<select id="getFestivalById" resultType="Festival" parameterType="int">
		SELECT *
		FROM festival
		WHERE festival_id = #{festivalId}
	</select>
	
	<select id="findFestivalList" resultType="Festival">
		SELECT *
		FROM festival
		order by festival_id
	</select>	
	
	<select id="findImagesByFestivalId" parameterType="int" resultType="FestivalImage">
        SELECT 
            image_id as imageId,
            festival_id as festivalId,
            file_path as filePath,
            file_name as fileName,
            mime_type as mimeType,
            uploaded_at as uploadedAt
        FROM festival_images
        WHERE festival_id = #{festivalId}        
    </select>
	
	<update id="incrementLikeCount" parameterType="int">
        UPDATE festival
        SET like_count = like_count + 1
        WHERE festival_id = #{festivalId}
    </update>
    
    <insert id="saveFestival" parameterType="Festival">
		insert into festival (festival_id, festival_name, location, start_date,
		end_date, entrance_fee, tel, festival_host, homepage_url)
		values (festival_id_seq.nextval,
		#{festivalName},
		#{location},
		#{startDate},
		#{endDate},
		#{entranceFee},
		#{tel},
		#{festivalHost},
		#{homepageUrl})
	</insert>
	
	<delete id="removeFestival" parameterType="int">
		DELETE FROM festival
		WHERE festival_id = #{festivalId}
	</delete>
    
    <select id="searchFestivals" resultType="Festival">
        SELECT *
        FROM festival
        WHERE festival_name LIKE #{searchQuery} or location LIKE #{searchQuery} or entrance_fee LIKE #{searchQuery}
        ORDER BY festival_id
    </select>
    
</mapper>
